---
db:
  poll:
    1:
      meeting_id: 1
      content_object_id: motion/1
      state: created
    2:
      meeting_id: 1
      content_object_id: motion/1
      state: published

  option:
    1:
      poll_id: 1
    2:
      poll_id: 2

  vote:
    1:
      # Unpublished, same user
      option_id: 1
      user_id: 1

    2:
      # Published, same user
      option_id: 2
      user_id: 1

    3:
      # Unpublished, other user
      option_id: 1
      user_id: 2

    4:
      # Unpublished, deligated user
      option_id: 2
      user_id: 2
      delegated_user_id: 1

  motion/1:
    meeting_id: 1
    state_id: 1

user_id: 1
fqfields:
- poll/1/id
- poll/1/votesvalid
- poll/1/votesinvalid
- poll/1/votescast
- poll/1/voted_ids
- poll/1/global_yes
- poll/1/global_no
- poll/1/global_abstain
- poll/2/id
- poll/2/votesvalid
- poll/2/votesinvalid
- poll/2/votescast
- poll/2/voted_ids
- poll/2/global_yes
- poll/2/global_no
- poll/2/global_abstain
- option/1/id
- option/1/yes
- option/1/no
- option/1/abstain
- option/2/id
- option/2/yes
- option/2/no
- option/2/abstain
- vote/1/id
- vote/2/id
- vote/3/id
- vote/4/id

cases:
- name: no perm
  can_see: []

- name: can_see
  permission: motion.can_see
  can_see:
  - poll/1/id
  - poll/2/id
  - poll/2/votesvalid
  - poll/2/votesinvalid
  - poll/2/votescast
  - poll/2/voted_ids
  - poll/2/global_yes
  - poll/2/global_no
  - poll/2/global_abstain
  - option/1/id
  - option/2/id
  - option/2/yes
  - option/2/no
  - option/2/abstain
  - vote/1/id
  - vote/2/id
  - vote/4/id

- name: can_manage
  permission: motion.can_manage
  can_see:
  - poll/1/id
  - poll/1/votesvalid
  - poll/1/votesinvalid
  - poll/1/votescast
  - poll/1/voted_ids
  - poll/1/global_yes
  - poll/1/global_no
  - poll/1/global_abstain
  - poll/2/id
  - poll/2/votesvalid
  - poll/2/votesinvalid
  - poll/2/votescast
  - poll/2/voted_ids
  - poll/2/global_yes
  - poll/2/global_no
  - poll/2/global_abstain
  - option/1/id
  - option/1/yes
  - option/1/no
  - option/1/abstain
  - option/2/id
  - option/2/yes
  - option/2/no
  - option/2/abstain
  - vote/1/id
  - vote/2/id
  - vote/3/id
  - vote/4/id
