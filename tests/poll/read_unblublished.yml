---
cases:
- name: unpublished poll
  db:
    poll/1:
      meeting_id: 1
      state: created

  fqfields:
  - poll/1/id
  - poll/1/votesvalid
  - poll/1/votesinvalid
  - poll/1/votescast
  - poll/1/voted_ids
  - poll/1/global_yes
  - poll/1/global_no
  - poll/1/global_abstain

  cases:
    - name: no perms
      can_see:

    - name: can_see
      permission: agenda_item.can_see
      can_see:
      - poll/1/id
      - poll/1/global_yes
      - poll/1/global_no
      - poll/1/global_abstain

    - name: can_manage
      permission: agenda_item.can_manage
      can_see:
      - poll/1/id
      - poll/1/votesvalid
      - poll/1/votesinvalid
      - poll/1/votescast
      - poll/1/voted_ids
      - poll/1/global_yes
      - poll/1/global_no
      - poll/1/global_abstain


- name: unpublished option
  db:
    poll/1:
      meeting_id: 1
      state: created
    option/1/poll_id: 1

  fqfields:
  - option/1/id
  - option/1/yes
  - option/1/no
  - option/1/abstain
  - option/1/vote_ids

  cases:
    - name: no perms
      can_see:

    - name: can_see
      permission: agenda_item.can_see
      can_see:
      - option/1/id

    - name: can_manage
      permission: agenda_item.can_manage
      can_see:
      - option/1/id
      - option/1/yes
      - option/1/no
      - option/1/abstain
      - option/1/vote_ids


- name: unpublished vote
  db:
    poll/1:
      meeting_id: 1
      state: created
    option/1/poll_id: 1
    vote/1:
      option_id: 1
      user_id: 1

  fqfields:
  - vote/1/id
  - vote/1/value
  - vote/1/weight

  cases:
    - name: no perms
      can_see:

    - name: no perms vote user
      user_id: 1
      can_see:

    - name: can_see
      permission: agenda_item.can_see
      can_see:

    - name: can_see vote user
      permission: agenda_item.can_see
      user_id: 1
      can_see:
      - vote/1/id
      - vote/1/value
      - vote/1/weight

    - name: can_manage
      permission: agenda_item.can_manage
      can_see:
      - vote/1/id
      - vote/1/value
      - vote/1/weight
